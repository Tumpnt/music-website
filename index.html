<!DOCTYPE html>
<html>

<head lang="en">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
	<link rel="stylesheet" href="style.css">


	<!-- libraies-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/rete@1.4.2/build/rete.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.6/vue.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/rete-vue-render-plugin@0.5.0/build/vue-render-plugin.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/rete-connection-plugin@0.9.0/build/connection-plugin.min.js"></script>

	<script src="lib/WebMIDIAPI.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/webmidi"></script>
	<script src="https://unpkg.com/interactjs/dist/interact.min.js"></script>
</head>

<body>
	<main>
		<div id="rete"></div>
	</main>
	<footer>
		<div id="piano-options">
			<input type="number" class="smallinput" id="midikeyoctave" value="4">
			<button type="button" onclick="$('#midikeyoctave')[0].value--">-</button>
			<button type="button" onclick="$('#midikeyoctave')[0].value++">+</button>
		</div>
		<div id="piano">
			<div></div>
		</div>
	</footer>
	<div id="clickoverlay">
		Click
	</div>

	<script>
		//Piano Creation
		{
			let key
			for (let i = 0; i < 132; i++) {
				key = document.createElement("SPAN");
				key.setAttribute("note", i)
				if ([1, 3, 6, 8, 10].indexOf(i % 12) > -1)
					key.setAttribute("class", "black")
				else {
					if (i % 12 == 0) {
						let key2 = document.createElement("SPAN");
						key2.innerHTML = (i / 12)
						key.appendChild(key2)
					}
					key.setAttribute("class", "white")
				}
				$("#piano *")[0].appendChild(key)
			}
		}

		interact('#piano')
			.resizable({
				edges: { left: false, right: false, bottom: false, top: true },
				modifiers: [
					// keep the edges inside the parent
					interact.modifiers.restrictEdges({
						outer: 'parent',
						endOnly: true
					}),
				],
			})
			.on('resizemove', function (event) {
				var target = event.target
				var y = (parseFloat(target.getAttribute('data-y')) || 0)
				// update the element's style
				if (event.rect.height < 56) {
					target.style['font-size'] = '0px'
					if (event.rect.height < 40)
						target.style.height = 0 + 'px'
					else
						target.style.height = event.rect.height + 'px'
				}
				else {
					target.style['font-size'] = 'initial'
					target.style.height = event.rect.height + 'px'
				}
				target.style.webkitTransform = target.style.transform = 'translateY(' + y + 'px)'
				target.setAttribute('data-y', y)
				target.children[0].style.width = event.rect.height + 'px'
			})
	</script>




	<!--scripts-->
	<script src="events.js"></script>
	<script src="sound.js"></script>
	<script src="input.js"></script>
	<script src="node-editor.js"></script>
	<script id="clickscript">
		document.getElementById('clickoverlay').onclick = function () {
			var elem = document.getElementById('clickoverlay')
			elem.parentNode.removeChild(elem);
			//start()
			sarpntEventHandler.dispatchEvent("start");
			var elem = document.getElementById('clickscript')
			elem.parentNode.removeChild(elem);
		}
	</script>

</body>

</html>